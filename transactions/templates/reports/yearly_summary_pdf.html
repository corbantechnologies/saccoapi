<!DOCTYPE html>
<html>

    <head>
        <meta charset="utf-8">
        <title>{{ member.member_no }} - Financial Summary {{ year }}</title>
        <style>
            @page {
                size: A4 landscape;
                margin: 1cm;

                @top-center {
                    content: "Tamarind SACCO";
                    font-size: 10pt;
                    font-weight: bold;
                }

                @bottom-center {
                    content: "Page " counter(page) " of " counter(pages);
                    font-size: 9pt;
                    color: #666;
                }
            }

            body {
                font-family: 'Segoe UI', Tahoma, sans-serif;
                color: #333;
                line-height: 1.5;
                font-size: 9pt;
            }

            .header {
                text-align: center;
                margin-bottom: 20px;
                padding-bottom: 10px;
                border-bottom: 2px solid #1e40af;
            }

            .logo {
                height: 50px;
                margin-bottom: 5px;
            }

            .title {
                margin: 0;
                font-size: 18pt;
                color: #1e40af;
            }

            .subtitle {
                margin: 5px 0;
                font-size: 10pt;
                color: #666;
            }

            .info-box {
                background: #f8f9fa;
                padding: 10px;
                border-radius: 5px;
                margin-bottom: 15px;
                display: flex;
                justify-content: space-between;
                font-size: 10pt;
            }

            .info-label {
                font-weight: 600;
                color: #1e40af;
            }

            table {
                width: 100%;
                border-collapse: collapse;
                font-size: 8pt;
            }

            th,
            td {
                border: 1px solid #ddd;
                padding: 4px 6px;
                text-align: right;
            }

            th {
                background: #f3f4f6;
                color: #111;
                font-weight: 600;
                text-align: center;
                vertical-align: bottom;
            }

            /* Level 1 Headers */
            .th-section {
                background: #e5e7eb;
                font-size: 9pt;
                border-bottom: 2px solid #ccc;
            }

            /* Level 2 Headers */
            .th-type {
                background: #f3f4f6;
                font-weight: bold;
            }

            /* Level 3 Headers */
            .th-col {
                color: #555;
                font-size: 7.5pt;
            }

            .month-col {
                text-align: left;
                font-weight: bold;
                background: #f9fafb;
                white-space: nowrap;
            }

            .footer {
                margin-top: 30px;
                text-align: center;
                font-size: 8pt;
                color: #888;
                border-top: 1px solid #eee;
                padding-top: 10px;
            }
        </style>
    </head>

    <body>

        <!-- Header -->
        <div class="header">
            <img src="{{ logo_url }}" alt="Logo" class="logo">
            <h1 class="title">Annual Financial Summary</h1>
            <p class="subtitle">Year: {{ year }} | Generated: {{ generated_at }}</p>
        </div>

        <!-- Member Info -->
        <div class="info-box">
            <div><span class="info-label">Member:</span> {{ member.member_no }} - {{ member.get_full_name }}</div>
            <div><span class="info-label">Email:</span> {{ member.email|default:"N/A" }}</div>
            <div><span class="info-label">Phone:</span> {{ member.phone|default:"N/A" }}</div>
        </div>

        <!-- Summary Table -->
        <table>
            <thead>
                <!-- Level 1: Sections -->
                <tr>
                    <th rowspan="3" class="th-section" style="width: 60px;">Month</th>
                    {% if savings_types %}
                    <th colspan="{{ savings_types|length|add:savings_types|length }}" class="th-section">Savings</th>
                    {% endif %}
                    {% if venture_types %}
                    <th colspan="{{ venture_types|length|add:venture_types|length|add:venture_types|length }}"
                        class="th-section">Ventures</th>
                    {% endif %}
                    {% if loan_types %}
                    <th colspan="{{ loan_types|length|add:loan_types|length|add:loan_types|length|add:loan_types|length }}"
                        class="th-section">Loans</th>
                    {% endif %}
                    <th rowspan="2" class="th-section">Guarantees</th>
                </tr>

                <!-- Level 2: Types -->
                <tr>
                    {% for t in savings_types %}
                    <th colspan="2" class="th-type">{{ t }}</th>
                    {% endfor %}
                    {% for t in venture_types %}
                    <th colspan="3" class="th-type">{{ t }}</th>
                    {% endfor %}
                    {% for t in loan_types %}
                    <th colspan="4" class="th-type">{{ t }}</th>
                    {% endfor %}
                </tr>

                <!-- Level 3: Columns -->
                <tr>
                    {% for t in savings_types %}
                    <th class="th-col">Dep</th>
                    <th class="th-col">Bal</th>
                    {% endfor %}
                    {% for t in venture_types %}
                    <th class="th-col">Dep</th>
                    <th class="th-col">Pay</th>
                    <th class="th-col">Bal</th>
                    {% endfor %}
                    {% for t in loan_types %}
                    <th class="th-col">Disb</th>
                    <th class="th-col">Rep</th>
                    <th class="th-col">Int</th>
                    <th class="th-col">Out</th>
                    {% endfor %}
                    <th class="th-col">Amt</th>
                </tr>
            </thead>
            <tbody>
                {% for row in table_rows %}
                <tr>
                    <td class="month-col">{{ row.month }}</td>

                    <!-- Savings -->
                    {% for s in row.savings %}
                    <td>{{ s.dep|floatformat:2 }}</td>
                    <td>{{ s.bal|floatformat:2 }}</td>
                    {% endfor %}

                    <!-- Ventures -->
                    {% for v in row.ventures %}
                    <td>{{ v.dep|floatformat:2 }}</td>
                    <td>{{ v.pay|floatformat:2 }}</td>
                    <td>{{ v.bal|floatformat:2 }}</td>
                    {% endfor %}

                    <!-- Loans -->
                    {% for l in row.loans %}
                    <td>{{ l.disb|floatformat:2 }}</td>
                    <td>{{ l.rep|floatformat:2 }}</td>
                    <td>{{ l.int|floatformat:2 }}</td>
                    <td>{{ l.out|floatformat:2 }}</td>
                    {% endfor %}
                    
                    <!-- Guarantees -->
                    <td>{{ row.guarantees|floatformat:2 }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="100" style="text-align: center; padding: 20px;">No data available</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Footer -->
        <div class="footer">
            <p>Â© {{ year }} Tamarind SACCO | All rights reserved | Confidential Document</p>
            <p>For inquiries: <a href="mailto:finance@wananchimali.com">finance@wananchimali.com</a></p>
        </div>

    </body>

</html>