<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <title>{{ member.member_no }} - {{ year }} Statement</title>
        <style>
            @page {
                size: A4 landscape;
                margin: 1cm;

                @bottom-right {
                    content: "Page " counter(page) " of " counter(pages);
                    font-size: 8pt;
                    color: #64748b;
                }

                @bottom-left {
                    content: "Generated on {{ generated_at }}";
                    font-size: 8pt;
                    color: #64748b;
                }
            }

            body {
                font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                color: #1e293b;
                line-height: 1.5;
                font-size: 9pt;
                margin: 0;
                padding: 0;
            }

            /* Top Header */
            .header-container {
                display: table;
                width: 100%;
                margin-bottom: 20px;
                border-bottom: 3px solid #1e40af;
                padding-bottom: 15px;
            }

            .header-logo {
                display: table-cell;
                vertical-align: middle;
                width: 150px;
            }

            .header-logo img {
                max-width: 150px;
                max-height: 60px;
            }

            .header-title {
                display: table-cell;
                vertical-align: middle;
                text-align: right;
            }

            .header-title h1 {
                margin: 0;
                font-size: 20pt;
                color: #1e40af;
                text-transform: uppercase;
                letter-spacing: -0.025em;
            }

            .header-title p {
                margin: 4px 0 0;
                font-size: 11pt;
                color: #64748b;
                font-weight: 500;
            }

            /* Info Grid */
            .info-section {
                display: table;
                width: 100%;
                margin-bottom: 30px;
                background: #f8fafc;
                border: 1px solid #e2e8f0;
                border-radius: 8px;
                padding: 15px;
            }

            .info-column {
                display: table-cell;
                width: 33.33%;
                padding: 0 10px;
            }

            .info-item {
                margin-bottom: 6px;
            }

            .info-label {
                color: #64748b;
                font-size: 8pt;
                text-transform: uppercase;
                font-weight: 600;
                display: block;
            }

            .info-value {
                font-size: 10pt;
                font-weight: 500;
                color: #0f172a;
            }

            /* Summary Cards */
            .summary-row {
                display: table;
                width: 100%;
                margin-bottom: 30px;
                border-spacing: 12px 0;
            }

            .summary-card {
                display: table-cell;
                background: white;
                border: 1px solid #e2e8f0;
                border-radius: 8px;
                padding: 15px;
                text-align: center;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            }

            .summary-card-label {
                font-size: 8pt;
                color: #64748b;
                text-transform: uppercase;
                font-weight: 700;
                margin-bottom: 8px;
            }

            .summary-card-value {
                font-size: 15pt;
                font-weight: 800;
                color: #0f172a;
            }

            .bg-blue {
                background-color: #eff6ff;
                border-color: #bfdbfe;
            }

            .bg-green {
                background-color: #f0fdf4;
                border-color: #bbf7d0;
            }

            .bg-amber {
                background-color: #fffbeb;
                border-color: #fde68a;
            }

            .bg-slate {
                background-color: #f8fafc;
                border-color: #e2e8f0;
            }

            /* Tables */
            .section-header {
                background: #1e40af;
                color: white;
                padding: 6px 12px;
                font-size: 10pt;
                font-weight: 700;
                border-radius: 4px 4px 0 0;
                margin-top: 25px;
            }

            table {
                width: 100%;
                border-collapse: collapse;
                font-size: 8pt;
                margin-bottom: 20px;
            }

            th,
            td {
                border: 1px solid #e2e8f0;
                padding: 6px 8px;
                text-align: right;
            }

            th {
                background: #f1f5f9;
                color: #475569;
                font-weight: 700;
                text-transform: uppercase;
                font-size: 7.5pt;
                text-align: center;
            }

            .month-col {
                text-align: left;
                font-weight: 700;
                color: #1e293b;
                background: #f8fafc;
                width: 90px;
            }

            .bal-cell {
                font-weight: 700;
                background: #f8fafc;
                color: #0f172a;
            }

            .zero {
                color: #cbd5e1;
            }

            /* Section Specific Styles */
            .savings-header {
                background: #059669;
            }

            .ventures-header {
                background: #d97706;
            }

            .loans-header {
                background: #2563eb;
            }

            tr:nth-child(even) td:not(.bal-cell) {
                background-color: #fafbfc;
            }

            /* Footer */
            .footer {
                margin-top: 40px;
                padding-top: 15px;
                border-top: 1px solid #e2e8f0;
                text-align: center;
                color: #94a3b8;
                font-size: 7.5pt;
            }

            .legal {
                font-style: italic;
                margin-top: 5px;
            }
        </style>
    </head>

    <body>

        <div class="header-container">
            <div class="header-logo">
                <img src="{{ logo_url }}" alt="Company Logo">
            </div>
            <div class="header-title">
                <h1>Annual Financial Summary</h1>
                <p>Member Statement &bull; Calendar Year {{ year }}</p>
            </div>
        </div>

        <div class="info-section">
            <div class="info-column">
                <div class="info-item">
                    <span class="info-label">Member Details</span>
                    <span class="info-value">{{ member.member_no }} - {{ member.get_full_name }}</span>
                </div>
            </div>
            <div class="info-column">
                <div class="info-item">
                    <span class="info-label">Contact Information</span>
                    <span class="info-value">{{ member.phone|default:"N/A" }} &bull; {{ member.email|default:"N/A"
                        }}</span>
                </div>
            </div>
            <div class="info-column">
                <div class="info-item">
                    <span class="info-label">Statement Period</span>
                    <span class="info-value">Jan 1, {{ year }} to Dec 31, {{ year }}</span>
                </div>
            </div>
        </div>

        <div class="summary-row">
            <div class="summary-card bg-green">
                <div class="summary-card-label">Net Savings</div>
                <div class="summary-card-value">Ksh. {{ chart_of_accounts.total_savings|floatformat:2 }}</div>
            </div>
            <div class="summary-card bg-amber">
                <div class="summary-card-label">Net Venture Capital</div>
                <div class="summary-card-value">Ksh. {{ chart_of_accounts.total_ventures|floatformat:2 }}</div>
            </div>
            <div class="summary-card bg-blue">
                <div class="summary-card-label">Loan Outstanding</div>
                <div class="summary-card-value">Ksh. {{ chart_of_accounts.total_loans|floatformat:2 }}</div>
            </div>
            <div class="summary-card bg-slate">
                <div class="summary-card-label">Total Guarantees</div>
                <div class="summary-card-value">Ksh. {{ total_active_guarantees|floatformat:2 }}</div>
            </div>
            <div class="summary-card bg-slate" style="border-left: 4px solid #1e40af;">
                <div class="summary-card-label">Fee Income</div>
                <div class="summary-card-value">Ksh. {{ chart_of_accounts.total_fee_income|floatformat:2 }}</div>
            </div>
            <div class="summary-card bg-slate" style="border-left: 4px solid #1e40af;">
                <div class="summary-card-label">Member Contributions</div>
                <div class="summary-card-value">Ksh. {{ chart_of_accounts.total_member_contributions|floatformat:2 }}
                </div>
            </div>
        </div>

        <!-- Savings Table -->
        <div class="section-header savings-header">I. SAVINGS ACCOUNTS ACTIVITY</div>
        <table>
            <thead>
                <tr>
                    <th rowspan="2" class="month-col">Month</th>
                    {% for t in savings_types %}
                    <th colspan="2">{{ t }}</th>
                    {% endfor %}
                </tr>
                <tr>
                    {% for t in savings_types %}
                    <th>Deposits</th>
                    <th>Balance</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for row in table_rows %}
                <tr>
                    <td class="month-col">{{ row.month }}</td>
                    {% for s in row.savings %}
                    <td class="{% if s.dep == 0 %}zero{% endif %}">{{ s.dep|floatformat:2 }}</td>
                    <td class="bal-cell {% if s.bal == 0 %}zero{% endif %}">{{ s.bal|floatformat:2 }}</td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Venture Table -->
        {% if venture_types %}
        <div class="section-header ventures-header" style="page-break-before: always;">II. VENTURE ACCOUNTS ACTIVITY
        </div>
        <table>
            <thead>
                <tr>
                    <th rowspan="2" class="month-col">Month</th>
                    {% for t in venture_types %}
                    <th colspan="3">{{ t }}</th>
                    {% endfor %}
                </tr>
                <tr>
                    {% for t in venture_types %}
                    <th>Dep.</th>
                    <th>Paid</th>
                    <th>Balance</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for row in table_rows %}
                <tr>
                    <td class="month-col">{{ row.month }}</td>
                    {% for v in row.ventures %}
                    <td class="{% if v.dep == 0 %}zero{% endif %}">{{ v.dep|floatformat:2 }}</td>
                    <td class="{% if v.pay == 0 %}zero{% endif %}">{{ v.pay|floatformat:2 }}</td>
                    <td class="bal-cell {% if v.bal == 0 %}zero{% endif %}">{{ v.bal|floatformat:2 }}</td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}

        <!-- Loans Table -->
        {% if loan_types %}
        <div class="section-header loans-header" style="page-break-before: always;">III. LOAN ACCOUNTS ACTIVITY</div>
        <table>
            <thead>
                <tr>
                    <th rowspan="2" class="month-col">Month</th>
                    {% for t in loan_types %}
                    <th colspan="4">{{ t }}</th>
                    {% endfor %}
                    <th rowspan="2">Guarantees</th>
                </tr>
                <tr>
                    {% for t in loan_types %}
                    <th>Disb.</th>
                    <th>Rep.</th>
                    <th>Int.</th>
                    <th>Out.</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for row in table_rows %}
                <tr>
                    <td class="month-col">{{ row.month }}</td>
                    {% for l in row.loans %}
                    <td class="{% if l.disb == 0 %}zero{% endif %}">{{ l.disb|floatformat:2 }}</td>
                    <td class="{% if l.rep == 0 %}zero{% endif %}">{{ l.rep|floatformat:2 }}</td>
                    <td class="{% if l.int == 0 %}zero{% endif %}">{{ l.int|floatformat:2 }}</td>
                    <td class="bal-cell {% if l.out == 0 %}zero{% endif %}">{{ l.out|floatformat:2 }}</td>
                    {% endfor %}
                    <td class="{% if row.total_guarantees == 0 %}zero{% endif %}">{{ row.total_guarantees|floatformat:2
                        }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}

        <!-- Fees Table -->
        {% if fee_types %}
        <div class="section-header" style="background: #475569; margin-top: 25px;">IV. FEES PAID ACTIVITY</div>
        <table>
            <thead>
                <tr>
                    <th class="month-col">Month</th>
                    {% for t in fee_types %}
                    <th>{{ t }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for row in table_rows %}
                <tr>
                    <td class="month-col">{{ row.month }}</td>
                    {% for f in row.fees %}
                    <td class="{% if f.amt == 0 %}zero{% endif %}">{{ f.amt|floatformat:2 }}</td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}

        <div class="footer">
            <p>&copy; {{ year }} Tamarind SACCO. All figures expressed in local currency (Ksh). This is an official
                system-generated document.</p>
            <p class="legal">Confidential - For use by authorized member only.</p>
        </div>

    </body>

</html>