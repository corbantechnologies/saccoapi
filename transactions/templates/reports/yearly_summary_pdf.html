<!DOCTYPE html>
<html>

    <head>
        <meta charset="utf-8">
        <title>{{ member.member_no }} - Financial Summary {{ year }}</title>
        <style>
            @page {
                size: A4 landscape;
                margin: 1cm;

                @top-center {
                    content: "Tamarind SACCO | Annual Summary";
                    font-size: 9pt;
                    font-weight: bold;
                    color: #555;
                }

                @bottom-center {
                    content: "Page " counter(page) " of " counter(pages);
                    font-size: 8pt;
                    color: #888;
                }
            }

            body {
                font-family: 'Segoe UI', Tahoma, Arial, sans-serif;
                color: #333;
                line-height: 1.4;
                font-size: 9pt;
            }

            /* HEADER & INFO */
            .header {
                text-align: center;
                margin-bottom: 20px;
                border-bottom: 2px solid #1e40af;
                padding-bottom: 10px;
            }

            .logo {
                height: 50px;
                margin-bottom: 5px;
            }

            .title {
                margin: 0;
                font-size: 16pt;
                color: #1e40af;
                text-transform: uppercase;
            }

            .subtitle {
                margin: 5px 0 0;
                font-size: 10pt;
                color: #555;
            }

            .member-info {
                background: #f0fdf4;
                border: 1px solid #bbf7d0;
                padding: 10px 15px;
                border-radius: 6px;
                margin-bottom: 20px;
                display: flex;
                justify-content: space-between;
                font-size: 10pt;
            }

            .member-info strong {
                color: #166534;
            }

            /* SUMMARY CARDS */
            .summary-grid {
                display: flex;
                gap: 15px;
                margin-bottom: 25px;
                page-break-inside: avoid;
            }

            .card {
                flex: 1;
                background: #fff;
                border: 1px solid #ddd;
                border-radius: 6px;
                padding: 12px;
                text-align: center;
                box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.05);
            }

            .card h3 {
                margin: 0 0 5px;
                font-size: 9pt;
                color: #666;
                text-transform: uppercase;
            }

            .card .amount {
                font-size: 14pt;
                font-weight: bold;
                color: #111;
                margin: 0;
            }

            .card.total {
                background: #f8fafc;
                border-color: #cbd5e1;
            }

            .card.total .amount {
                color: #0f172a;
            }

            /* SECTIONS */
            .section-title {
                font-size: 12pt;
                color: #1e40af;
                margin: 20px 0 10px;
                border-bottom: 1px solid #ccc;
                padding-bottom: 4px;
            }

            /* TABLES */
            table {
                width: 100%;
                border-collapse: collapse;
                font-size: 8.5pt;
                margin-bottom: 20px;
                page-break-inside: avoid;
            }

            th,
            td {
                border: 1px solid #e2e8f0;
                padding: 5px 8px;
                text-align: right;
            }

            th {
                background: #f1f5f9;
                color: #334155;
                font-weight: 600;
                text-align: center;
            }

            .th-left {
                text-align: left;
            }

            tr:nth-child(even) {
                background-color: #f8fafc;
            }

            .month-col {
                text-align: left;
                font-weight: bold;
                color: #333;
                width: 80px;
                background: #fdfdfd;
            }

            .zero {
                color: #cbd5e1;
            }

            .footer {
                margin-top: 40px;
                text-align: center;
                font-size: 8pt;
                color: #94a3b8;
                border-top: 1px solid #e2e8f0;
                padding-top: 10px;
            }
        </style>
    </head>

    <body>

        <!-- Header -->
        <div class="header">
            <img src="{{ logo_url }}" alt="Logo" class="logo">
            <h1 class="title">Member Financial Summary</h1>
            <p class="subtitle">{{ year }} Statement</p>
        </div>

        <!-- Member Info -->
        <div class="member-info">
            <div><strong>Member:</strong> {{ member.member_no }} - {{ member.get_full_name }}</div>
            <div><strong>Email:</strong> {{ member.email|default:"-" }}</div>
            <div><strong>Phone:</strong> {{ member.phone|default:"-" }}</div>
        </div>

        <!-- Summary Cards -->
        <div class="summary-grid">
            <div class="card">
                <h3>Total Savings</h3>
                <p class="amount">{{ chart_of_accounts.total_savings|floatformat:2 }}</p>
            </div>
            <div class="card">
                <h3>Net Ventures</h3>
                <p class="amount">{{ chart_of_accounts.total_ventures|floatformat:2 }}</p>
            </div>
            <div class="card">
                <h3>Loan Outstanding</h3>
                <p class="amount">{{ chart_of_accounts.total_loans|floatformat:2 }}</p>
            </div>
            <div class="card total">
                <h3>Guaranteed (Active)</h3>
                <p class="amount">{{ total_active_guarantees|floatformat:2 }}</p>
            </div>
        </div>

        <!-- 1. SAVINGS SECTION -->
        <h2 class="section-title">Savings Breakdown</h2>
        <table>
            <thead>
                <tr>
                    <th class="th-left">Month</th>
                    {% for t in savings_types %}
                    <th colspan="2">{{ t }}</th>
                    {% endfor %}
                </tr>
                <tr>
                    <th></th>
                    {% for t in savings_types %}
                    <th>Dep</th>
                    <th>Bal</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for row in table_rows %}
                <tr>
                    <td class="month-col">{{ row.month }}</td>
                    {% for s in row.savings %}
                    <td class="{% if s.dep == 0 %}zero{% endif %}">{{ s.dep|floatformat:2 }}</td>
                    <td class="{% if s.bal == 0 %}zero{% endif %}" style="font-weight: 500;">{{ s.bal|floatformat:2 }}
                    </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- 2. VENTURES SECTION -->
        {% if venture_types %}
        <h2 class="section-title">Ventures Breakdown</h2>
        <table>
            <thead>
                <tr>
                    <th class="th-left">Month</th>
                    {% for t in venture_types %}
                    <th colspan="3">{{ t }}</th>
                    {% endfor %}
                </tr>
                <tr>
                    <th></th>
                    {% for t in venture_types %}
                    <th>Dep</th>
                    <th>Paid</th>
                    <th>Bal</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for row in table_rows %}
                <tr>
                    <td class="month-col">{{ row.month }}</td>
                    {% for v in row.ventures %}
                    <td class="{% if v.dep == 0 %}zero{% endif %}">{{ v.dep|floatformat:2 }}</td>
                    <td class="{% if v.pay == 0 %}zero{% endif %}">{{ v.pay|floatformat:2 }}</td>
                    <td class="{% if v.bal == 0 %}zero{% endif %}" style="font-weight: 500;">{{ v.bal|floatformat:2 }}
                    </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}

        <!-- 3. LOANS SECTION -->
        {% if loan_types %}
        <h2 class="section-title">Loans Breakdown</h2>
        <table>
            <thead>
                <tr>
                    <th class="th-left">Month</th>
                    {% for t in loan_types %}
                    <th colspan="4">{{ t }}</th>
                    {% endfor %}
                </tr>
                <tr>
                    <th></th>
                    {% for t in loan_types %}
                    <th>Disb</th>
                    <th>Rep</th>
                    <th>Int</th>
                    <th>Out</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for row in table_rows %}
                <tr>
                    <td class="month-col">{{ row.month }}</td>
                    {% for l in row.loans %}
                    <td class="{% if l.disb == 0 %}zero{% endif %}">{{ l.disb|floatformat:2 }}</td>
                    <td class="{% if l.rep == 0 %}zero{% endif %}">{{ l.rep|floatformat:2 }}</td>
                    <td class="{% if l.int == 0 %}zero{% endif %}">{{ l.int|floatformat:2 }}</td>
                    <td class="{% if l.out == 0 %}zero{% endif %}" style="font-weight: 500;">{{ l.out|floatformat:2 }}
                    </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}

        <!-- Footer -->
        <div class="footer">
            <p>Â© {{ year }} Tamarind SACCO. All figures are in your local currency. This document is system generated.
            </p>
        </div>

    </body>

</html>