<!DOCTYPE html>
<html>

    <head>
        <meta charset="utf-8">
        <title>{{ member.member_no }} - Financial Summary {{ year }}</title>
        <style>
            @page {
                size: A4 landscape;
                margin: 1cm;

                @bottom-center {
                    content: "Page " counter(page) " of " counter(pages);
                    font-size: 9pt;
                    color: #666;
                }
            }

            body {
                font-family: 'Segoe UI', Tahoma, sans-serif;
                color: #333;
                line-height: 1.3;
                font-size: 9pt;
            }

            .container {
                max-width: 100%;
            }

            .header {
                text-align: center;
                margin-bottom: 15px;
                padding-bottom: 10px;
                border-bottom: 2px solid #1e40af;
            }

            .logo {
                height: 50px;
                margin-bottom: 5px;
            }

            .title {
                margin: 0;
                font-size: 20px;
                color: #1e40af;
            }

            .subtitle {
                margin: 4px 0;
                font-size: 12px;
                color: #666;
            }

            .info-box {
                background: #f8f9fa;
                padding: 10px;
                border-radius: 6px;
                margin: 10px 0;
                display: flex;
                justify-content: space-between;
                flex-wrap: wrap;
                font-size: 10pt;
            }

            .info-label {
                font-weight: 600;
                color: #1e40af;
            }

            /* Table Styles */
            table {
                width: 100%;
                border-collapse: collapse;
                margin: 10px 0;
                font-size: 8pt;
            }

            th,
            td {
                border: 1px solid #e5e7eb;
                padding: 4px 6px;
                text-align: right;
            }

            th {
                background: #f3f4f6;
                color: #111827;
                font-weight: 600;
                text-align: center;
                vertical-align: bottom;
            }

            .th-section {
                background: #1e40af;
                color: white;
                border-color: #1e40af;
            }

            .th-type {
                background: #e5e7eb;
            }

            .month-col {
                text-align: left;
                font-weight: 600;
                background: #f9fafb;
                white-space: nowrap;
            }

            .total-row td {
                background: #f0f7ff;
                font-weight: bold;
            }

            .footer {
                margin-top: 20px;
                text-align: center;
                font-size: 8px;
                color: #888;
                border-top: 1px solid #eee;
                padding-top: 10px;
            }
        </style>
    </head>

    <body>

        <div class="container">

            <!-- Header -->
            <div class="header">
                <img src="{{ logo_url }}" alt="Logo" class="logo">
                <h1 class="title">Annual Financial Summary</h1>
                <p class="subtitle">Year: {{ year }} | Generated: {{ generated_at }}</p>
            </div>

            <!-- Member Info -->
            <div class="info-box">
                <div><span class="info-label">Member No:</span> {{ member.member_no }}</div>
                <div><span class="info-label">Name:</span> {{ member.get_full_name }}</div>
                <div><span class="info-label">Email:</span> {{ member.email|default:"N/A" }}</div>
                <div><span class="info-label">Phone:</span> {{ member.phone|default:"N/A" }}</div>
            </div>

            <!-- MAIN SUMMARY TABLE -->
            <table>
                <thead>
                    <!-- Level 1: Section Headers -->
                    <tr>
                        <th rowspan="3" class="th-section" style="vertical-align: middle; width: 60px;">Month</th>
                        {% if savings_types %}
                        <th colspan="{{ savings_types|length|add:savings_types|length }}" class="th-section">Savings
                        </th>
                        {% endif %}
                        {% if venture_types %}
                        <th colspan="{{ venture_types|length|add:venture_types|length|add:venture_types|length }}"
                            class="th-section">Ventures</th>
                        {% endif %}
                        {% if loan_types %}
                        <th colspan="{{ loan_types|length|add:loan_types|length|add:loan_types|length|add:loan_types|length }}"
                            class="th-section">Loans</th>
                        {% endif %}
                    </tr>

                    <!-- Level 2: Type Headers -->
                    <tr>
                        {% for t in savings_types %}
                        <th colspan="2" class="th-type">{{ t }}</th>
                        {% endfor %}

                        {% for t in venture_types %}
                        <th colspan="3" class="th-type">{{ t }}</th>
                        {% endfor %}

                        {% for t in loan_types %}
                        <th colspan="4" class="th-type">{{ t }}</th>
                        {% endfor %}
                    </tr>

                    <!-- Level 3: Column Labels -->
                    <tr>
                        {% for t in savings_types %}
                        <th>Dep</th>
                        <th>Bal</th>
                        {% endfor %}

                        {% for t in venture_types %}
                        <th>Dep</th>
                        <th>Pay</th>
                        <th>Bal</th>
                        {% endfor %}

                        {% for t in loan_types %}
                        <th>Disb</th>
                        <th>Rep</th>
                        <th>Int</th>
                        <th>Out</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for row in table_rows %}
                    <tr>
                        <td class="month-col">{{ row.month }}</td>

                        <!-- Savings -->
                        {% for s in row.savings %}
                        <td>{{ s.dep|floatformat:2 }}</td>
                        <td>{{ s.bal|floatformat:2 }}</td>
                        {% endfor %}

                        <!-- Ventures -->
                        {% for v in row.ventures %}
                        <td>{{ v.dep|floatformat:2 }}</td>
                        <td>{{ v.pay|floatformat:2 }}</td>
                        <td>{{ v.bal|floatformat:2 }}</td>
                        {% endfor %}

                        <!-- Loans -->
                        {% for l in row.loans %}
                        <td>{{ l.disb|floatformat:2 }}</td>
                        <td>{{ l.rep|floatformat:2 }}</td>
                        <td>{{ l.int|floatformat:2 }}</td>
                        <td>{{ l.out|floatformat:2 }}</td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <!-- Footer -->
            <div class="footer">
                <p>Â© {{ year }} Tamarind SACCO | All rights reserved | Confidential Document</p>
                <p>For inquiries: <a href="mailto:finance@wananchimali.com">finance@wananchimali.com</a></p>
            </div>

        </div>
    </body>

</html>